% Colin-N. Brosseau
% Juin 2016
%
% This document is based on 
% http://www.LaTeXTemplates.com
% Original author:
% Mathias Legrand (legrand.mathias@gmail.com) with modifications by:
% Vel (vel@latextemplates.com)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
% Compile it from the command line with the  commands below to make
% sure your LaTeX distribution is configured correctly:
%
%     pdflatex procedurierLeonelli
%     makeindex procedurierLeonelli.idx -s StyleInd.ist
%     pdflatex procedurierLeonelli 
%     pdflatex procedurierLeonelli 
%
% Easy compilation (latexmk needed)
%
%     make

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

%\documentclass[11pt,fleqn]{book} % Default font size and left-justified equations
\documentclass[11pt,francais]{book} % Default font size and left-justified equations

\usepackage[francais]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% Creative commons
\usepackage{cclicenses}

\usepackage{matlab-prettifier}

% Code source
\usepackage{listings}             % Include the listings-package
\usepackage{color}

\usepackage{hyperref}  % pour mettre des liens cliquables (à implémenter ???)

% Insérer des fichiers pdf 
\usepackage{pdfpages}

\definecolor{lightgrey}{rgb}{0.9,0.9,0.9}
\definecolor{stringcolor}{rgb}{.63,.13,.94} % for strings

\lstset{
  frame=single,
  breaklines=true,
  basicstyle=\small,
  backgroundcolor=\color{lightgrey},
  basicstyle = \mlttfamily
}

\lstdefinestyle{Python}{
    language=Python,
    backgroundcolor=\color{white},
    commentstyle=\itshape\color{green!40!black},
    keywordstyle=\color{blue},
    stringstyle = \color{stringcolor}
}

% Diagrammes (boites)
\usepackage{smartdiagram}

%----------------------------------------------------------------------------------------

\input{structure} % Insert the commands.tex file which contains the majority of the structure behind the template

\begin{document}

\renewcommand{\lstlistingname}{Code}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\begingroup
\thispagestyle{empty}
\begin{tikzpicture}[remember picture,overlay]
\coordinate [below=12cm] (midpoint) at (current page.north);
\node at (current page.north west)
{\begin{tikzpicture}[remember picture,overlay]
%\node[anchor=north west,inner sep=0pt] at (0,0) {\includegraphics[width=\paperwidth,bb=0 0 100 100]{background}}; % Background image
\node[anchor=north west,inner sep=0pt] at (0,0) {\includegraphics[width=\paperwidth]{background}}; % Background image
\draw[anchor=north] (midpoint) node [fill=ocre!30!white,fill opacity=0.6,text opacity=1,inner sep=1cm]{\Huge\centering\bfseries\sffamily\parbox[c][][t]{\paperwidth}{\centering Procédurier\\[15pt] % Book title
{\Large Laboratoire R. Leonelli}\\[20pt] % Subtitle
{\Large Colin-N. Brosseau}}}; % Author name
\end{tikzpicture}};
\end{tikzpicture}
\vfill
\endgroup

%----------------------------------------------------------------------------------------
%	COPYRIGHT PAGE
%----------------------------------------------------------------------------------------

\newpage
~\vfill
\thispagestyle{empty}

%\doclicenseThis

\noindent Copyright \copyright\ 2016 Colin-N. Brosseau\\ % Copyright notice

%\noindent \textsc{Published by Publisher}\\ % Publisher

\noindent \textsc{https://github.com/ColinBrosseau/LaboratoireLeonelli}\\ % URL

\noindent \cc \ccnc \bysa

\noindent Texte licensé sous licence Creative Commons attribution, pas d’utilisation commerciale, partage dans les mêmes conditions \url{http://creativecommons.org/licenses/by-nc-sa/3.0/fr/}.

%\noindent \textit{Première édition, Juillet 2016} % Printing/edition date
\noindent \textit{Édition 0.1, Juin 2016} % Printing/edition date

%----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS
%----------------------------------------------------------------------------------------

%\usechapterimagefalse % If you don't want to include a chapter image, use this to toggle images off - it can be enabled later with \usechapterimagetrue

\chapterimage{laser} % Table of contents heading image

%\usechapterimagefalse % If you don't want to include a chapter image, use this to toggle images off - it can be enabled later with \usechapterimagetrue

\pagestyle{empty} % No headers

\tableofcontents % Print the table of contents itself

\cleardoublepage % Forces the first chapter to start on an odd page so it's on the right

\pagestyle{fancy} % Print headers again

%----------------------------------------------------------------------------------------
%	PART
%----------------------------------------------------------------------------------------

%\part{Première partie}
 
%----------------------------------------------------------------------------------------
%	CHAPTER 1
%----------------------------------------------------------------------------------------

\chapterimage{laser} % Chapter heading image

\chapter{Logiciels}

De nombreux logiciels ont été mis au point dans le but de contrôler les nombreux appareils et expériences du laboratoire.
En général, les expériences et appareils fonctionnant dans le laboratoire {\it Trivista} utilisent Matlab.
De son côté, le laboratoire {\it U1000} est complètement implémenté avec Python\footnote{De nombreux appareils du laboratoire {\it U1000}~ont un interface Matlab, mais aucune mise à jour n'est faite depuis un moment.}.

\section{Matlab}%\index{Matlab}

À moins d'indication contraire, les codes Matlab utilisés au laboratoire ont été testés avec la version 7.1 (R14).

\subsection{Codes supplémentaires}

Plusieurs instruments sont contrôlés par cable GPIB.
On utilise deux ``modules'' associés:
\begin{itemize}
\item http://www.mathworks.com/matlabcentral/fileexchange/216
\item http://www.mathworks.com/matlabcentral/fileexchange/3140
%\caption{Modules GPIB utilisés par Matlab}
\label{tableModulesGPIBMatlab}
\end{itemize}
Les deux sont complémentaires.
Le premier, de Tom Davis, sert à la communication.
Le deuxième, d'Alaa Makdissi, est surtout utilisé pour l'initialisation.

\section{Python}\index{Python}

Plusieurs instruments du laboratoire peuvent être contrôlés avec Python.
En général, il s'agit des instruments situés dans le D405 (Labo Raman).

À l'heure actuelle, la manière la plus simple d'installer python sur windows est d'utiliser la {\bf distribution anaconda} https://www.continuum.io/downloads.
Il existe deux branches de Python soient la 2 et la 3. On prend {\bf Python 3}.

\subsection{Modules}

L'installation de base d'anaconda contient la plupart des modules nécessaires au fonctionnement des scripts utilisés dans le laboratoire.
On installe des modules supplémentaires de la fa\c{c}on suivante:
\begin{itemize}
\item Démarrer > Anaconda (32-bit) > Anaconda Command Prompt
 \item Enter la ligne suivante (en adaptant avec le nom du module voulu) dans la console.
\end{itemize}

\begin{lstlisting}[
    caption={Installation d'un module Python avec {\it pip} (dans la console)},
%    label={lst:exVisa},
  ]
pip install nom_du_module
\end{lstlisting}

Les modules nécessaires pour pouvoir utiliser les scripts con\c{c}us pour le laboratoire sont énumérés dans la table \ref{tab:ModulesNecessairesPython}.
Les modules qui n'ont pas de nom pip sont présents de manière native sous Python.

\begin{table}[htbf]
  \caption{Modules nécessaires au fonctionnement des scripts du laboratoire}
  \label{tab:ModulesNecessairesPython}
  \centering
  \resizebox{\textwidth}{!}{%
    \begin{tabular}{lll}
      \multicolumn{1}{c}{\textbf{Module}} & \multicolumn{1}{c}{\textbf{nom sous pip}} & \multicolumn{1}{c}{\textbf{Rôle}}                                \\ \hline
      visa                & pyvisa               & contrôle des instruments (RS232, GPIB)                           \\
      struct              &  -              & utilisé par SR830c pour lire le flux binaire                     \\
      yaml                  & pyyaml             & lire/écrire des fichiers sous format YAML                        \\
      collections           & -             & utilisé pour créer des dictionnaires ordonnés                    \\
      pandas                & pandas             & manipulation simplifiée des structures des données scientifiques \\
      matplotlib            & matplotlib             & tracer des graphiques                                            \\
    \end{tabular}%
    }
\end{table}

\subsubsection{visa}\index{visa}

Le module {\it visa}\footnote{\url{https://pyvisa.readthedocs.io/en/stable/}} permet d'interagir facilement avec les instruments du laboratoire.
Il nécessite que {\it LabView} soit installé sur l'ordinateur (??? à confirmer).
Le Code~\ref{lst:exVisa} montre un exemple minimal de son utilisation.

\begin{lstlisting}[
    caption={Exemple d'utilisation de {\it visa}},
    label={lst:exVisa},breaklines=true,
    style=Python,
  ]  
 
import visa  # importe le module
rm = visa.ResourceManager()

# affiche la liste des appareils connectes
rm.list_resources()  
# ex. de sortie:
#     ('ASRL1::INSTR', 'ASRL2::INSTR', 'GPIB0::12::INSTR')

# initialise la communication
inst = rm.open_resource('GPIB0::12::INSTR')  # appareil connecte sur le permier interface GPIB a l'adresse 12

# questionne l'appareil
print(inst.query("*IDN?"))  # indenfication de l'appareil (commande typique)

# Ce qui suit est equivalent a query, mais en deux etapes

# ecrit dans l'appareil
inst.write("*IDN?")

# lit la reponse de l'appareil
print(inst.read("*IDN?"))

\end{lstlisting}

\subsubsection{Matplotlib}

??? faire un mini crash course ici

Pour un tutoriel sur l'utilisation de Matplotlib, se référer à l'adresse \url{http://matplotlib.org/users/pyplot_tutorial.html}.

\subsubsection{Pandas}

??? faire un mini crash course ici

\url{http://pandas.pydata.org/pandas-docs/stable/10min.html#min}

\url{http://nbviewer.jupyter.org/github/jvns/pandas-cookbook/blob/v0.1/cookbook/Chapter%201%20-%20Reading%20from%20a%20CSV.ipynb}



%----------------------------------------------------------------------------------------
%	CHAPTER 2
%----------------------------------------------------------------------------------------

\chapter{Instruments}

%----------------------------------------------------------------------------------------

\section{Bomem}\index{Bomem}

\subsection{Démarrage}

\begin{itemize}
\item Allumer le Bomem (interrupteur en bas en arrière).
\item Allumer le processeur vectoriel (DA-PC).
\item Démarrer le logiciel BOMEM PCDA.
\item Lorsque l'affichage du processeur vectoriel passe à 6, cliquer sur OK dans la fenètre du logiciel.
\item Charger une configuration appropriée pour le détecteur/lame séparatrice (Experiment>Open...).
\item Dans la configuration, spécifier
  \begin{itemize}
    \item de quel côté se trouve le détecteur (gauche ou droite)
    \item quelle est l'entrée utilisée par le détecteur 1,2,3, etc.
  \end{itemize}
\item Connecteur la sortie de l'amplificateur du détecteur dans l'entrée spécifiée.
\end{itemize}

\subsubsection{Configuration relative aux détecteur}

La nature du détecteur influence les paramètres de la mesure.
La table~\ref{table:configurationBomemDetecteur} indique les paramètres recommandés en fonction du détecteur utilisé.

% table générée avec http://truben.no/table/
\begin{table}
  \caption{Configuration du Bomem relative au détecteur}
  \label{table:configurationBomemDetecteur}
  \centering
  \resizebox{\textwidth}{!}{%  
    \begin{tabular}{c|ccccc}
      ~               & Si           & MCT          & InSb         & InGaAs       & Ge (vis)     \\ \hline
      Source          & 2000 - 25000 & 2000 - 25000 & 2000 - 25000 & 2000 - 25000 & 2000 - 25000 \\
      Beamsplitter    & 4000 - 25000 & 1200 - 10000 & 2000-25000   & 4000 - 25000 & 4000 - 25000 \\
      Filter          & 0 - 63192    & 0 - 63192    & 0 - 63192    & 0 - 63192    & 0 - 63192    \\
      Detector        & 9999 - 25000 & 2000 - 8000  & 3000 - 14000 & 5000 - 12000 & 5000 - 13000 \\
      Time Delay (us) & 1.6          & 4            & 4            & 0.1          & 160          \\
      Speed (cm/s)    & 0.5          & 0.15         & 0.05         & 0.1          & 0.5          \\
%      Gain (Base)     & 64           &              &              &              &              \\
%      Gain (Pos)\footnote{Si on a des oscillations dans la mesure, mettre se paramètre à None permet de les enlever.}
%                      & None         &              &              &              &              \\
%      Gain (Fringe \#) & 200          &              &              &              &              \\
    \end{tabular}
  }
\end{table}

\subsubsection{Gain du détecteur}

Il est possible d'appliquer deux gains sur le signal du détecteur.
Ces paremètres sont ajustés juste avant la mesure, lorsqu'on clique sur {\it Raw Spectrum}.
Entre la frange 1 et {\it Fringe \#} le signal du détecteur est amplifié d'un facteur {\it Gain Base}.
Le signal suivant les franges {\it Fringe \#} sont amplifiées d'un facteur {\it Gain Pos}.

(??? à confirmer auprès de Richard) Seul les détecteurs utilisant les amplificateurs Bomem (dans notre cas le détecteur silicium) prennent en compte le {\it Gain Pos}.

Si de fortes oscillations se produisent dans l'interférogramme et/ou le spectre il faut mettre {\it Gain Pos} à {\it None}.\footnote{Il est aussi possible que les oscillations dans l'interférogramme soient causées par l'excitation laser. Dans ce cas, il faut la diminuer, en général à l'aide d'un filtre coloré.} 
 
\subsection{Logiciel du Bomem}

Dans le logiciel du Bomem, le bouton \fbox{\%ADC} permet d'avoir une idée de l'intensité du signal.
Le détecteur sature lorsqu'il indique {\bf >100}.
Lorsque le détecteur est complètement saturé, il indique {\bf 0}.

\subsection{Transfert des données de l'ordinateur du Bomem vers l'extérieur}

Pour transférer des données à l'extérieur de l'ordinateur de contrôle du Bomem, il y a deux possibilités\footnote{Les clés USB ne fonctionnent pas sur cet ordinateur.}:
\begin{itemize}
\item disquettes
\item connection réseau\footnote{L'ordinateur de contrôle du Bomem est très vieux et ne doit jamais être laissé connecté au réseau en permanence.}
  \begin{itemize}
    \item l'ordinateur du Bomem apparait sur le réseau PMC sous \verb!\\Bomem333!. Les données se trouvent dans le répertoire {\it DONNEES}.
    \end{itemize}
\end{itemize}



\subsection{Transfert des mesures vers Matlab}

On utilise la fonction \verb!bomem.m! pour convertir les données binaires prises par le logiciel en variables Matlab.
Code~\ref{lst:bomem} montre comment utiliser cette fonction.

\begin{lstlisting} [
    caption={Lecture des données brutes du Bomem avec Matlab},
    label={lst:bomem},
    style      = Matlab-editor,
]

[x,y] = bomem(fichier_sans_extension_spc, unite, calibration)

% fichier_sans_extension_spc
%     nom du fichier.spc (on ne doit pas mettre l'extension .spc)

% unite: 
%     0	cm-1
%     1	eV
%     2	A

% calibration
%     0	pas de calibration
%     1	Si - lame quartz
%     2	InGaAs - lame quartz
%     3	Ge - lame CaF2
%     4	InSb - lame quartz
%     5	InSb - lame CaF2

% x
%     position spectrale (depend de unite)
% y
%     intensite mesuree

\end{lstlisting}

\subsection{Détecteurs}

\subsubsection{Détecteur Silicium}

Le détecteur Silicium est utilisé pour les mesures faites dans le visible.
Il utilise l'amplificateur installé sur le côté de son support.

\subsubsection{Détecteur InGaAs}

Le détecteur InGaAs\footnote{Numéro de modèle: J23D-M205-R01M-60-1.9, http://www.teledynejudson.com/files/pdf/ingaas\_PB4206.pdf} est sensible dans la gamme 1000 - 1900 nm\footnote{La longueur d'onde maximale détectée dépend de la température. Elle est de 1900 nm à 20 $^{\circ}$C) mais passe à 1810 nm à -85 $^{\circ}$C. Une estimation rapide porte la longueur d'onde maximale à $\approx$ 1750 nm à température de l'azote liquide.}.

Ce détecteur a besoin d'azote liquide pour fonctionner.
Il est recommandé de pomper le vide d'isolation tous les 6 mois.

Le signal de ce détecteur est amplifié\footnote{Amplificateur PA-7-70, RD=70 G$\Omega$, CD=870 pF, RS=10.36 $\Omega$}.
Pour l'utilisation avec le Bomem, on utilise la sortie DC (premier étage).

\begin{figure}[htbp]
  \centering\includegraphics[width=.5\linewidth,height=7cm,keepaspectratio]{Bomem-InGaAs-Sensibilite-LongueurOnde}
  \caption{Sensibilité détecteur Bomem InGaAs (à 20 $^{\circ}$C)}
  \label{fig:bomemInGaAs}
\end{figure}



\subsubsection{Détecteur InSb}
Le détecteur InSb\footnote{Numéro de modèle: J10D-M204-R01M-60-SP28, http://www.judsontechnologies.com/files/pdf/InSb\_shortform\_Mar2003.pdf} est sensible dans la gamme 1000-2800 nm.

Ce détecteur a besoin d'azote liquide pour fonctionner.
Il est recommandé de pomper le vide d'isolation tous les 6 mois.

Le signal de ce détecteur est amplifié\footnote{Amplificateur PA-9, RD=150 M$\Omega$, CD=355 pF}.
Pour l'utilisation avec le Bomem, on utilise la sortie DC (premier étage).

\begin{figure}[htbp]
  \centering\includegraphics[width=.5\linewidth,height=7cm,keepaspectratio]{Bomem-InSb-Sensibilite-LongueurOnde}
  \caption{Sensibilité détecteur Bomem InSb (à 77 K)}
  \label{fig:bomemInSb}
\end{figure}


%----------------------------------------------------------------------------------------

\section{Caméras Princeton Instruments}

Les caméras Princeton Instruments (la PDA InGaAs et la Pixis) sont contrôlées soit par le logiciel Winspec ou par Matlab.
Les deux sont mutuellement exclusifs à un instant donné.

Lorsqu'on change de détecteur (passant de la PDA à la Pixis ou inversement), il {\bf faut} redémarrer Winspec et faire la procédure de détection.
Parfois ca ne fonctionne pas: il faut débrancher le cable USB du Trivista et recommencer.
Il arrive également qu'on doive redémarrer complètement l'ordinateur

\subsection{Winspec}

Winspec permet de vérifier que la caméra fonctionne et tester rapidement le signal.
Il n'y a pas de calibration Pixel $\rightarrow$ Longueur d'onde.

\subsection{Matlab}

Matlab peut contrôler les caméras Princeton Instruments via la librairie pvcam\footnote{Le logiciel PVCAM est disponible à l'adresse \url{http://ftp.piacton.com/Public/Software/Official/PVCAM/pvcam32.exe}. La documentation relative à PVCAM se trouve à \url{http://ftp.piacton.com/Public/Manuals/Princeton\%20Instruments/PVCAM\%202.7\%20Software\%20User\%20Manual.pdf}}:
\begin{center}
  \smartdiagramset{border color=none,
    uniform color list=gray!100!black for 10 items,
    back arrow disabled=true,}
  \smartdiagram[flow diagram:horizontal]{Matlab, pvcam, Caméra Princeton Instruments}
\end{center}

%\smartdiagram[flow diagram:horizontal,back arrow disabled=false,]{Matlab,  pvcam, Caméra Princeton Instruments}

\begin{lstlisting} [
    caption={Exemple d'utilisation des caméras Princeton Instruments avec Matlab},
    label={lst:excameraprincetoninstruments},
    style=Matlab-editor,
]

% initialise la communication
camera_PrincetonInstruments('initialise')

% temperature cible du detecteur (C)
Camera_PrincetonInstruments('TEMP_SETPOINT')  % lit
Camera_PrincetonInstruments('TEMP_SETPOINT', -70)  % ecrit
% temperature reele du detecteur (C)
Camera_PrincetonInstruments('TEMP')  % lit

% nom de la camera (tel que vu par Winspec)
Camera_PrincetonInstruments('nom')
% nom du detecteur CCD
Camera_PrincetonInstruments('CHIP_NAME')

% lit/ecrit le gain
Camera_PrincetonInstruments('GAIN')
Camera_PrincetonInstruments('GAIN', 2)
% lit/ecrir la vitesse de l'ADC
Camera_PrincetonInstruments('SPEED')
Camera_PrincetonInstruments('SPEED','100 kHz')

% taille (en pixels) du detecteur
[xsize, ysize] = Camera_PrincetonInstruments('DIMENSION_DETECTEUR')

% obturateur mecanique
Camera_PrincetonInstruments('SHUTTER','ferme')  % ferme
Camera_PrincetonInstruments('SHUTTER','ouvert')  % ouvre

% mesure un spectre (somme ``verticalement'') sur toute la plage disponible
PARAM.window = struct
PARAM.window.s1 = 0;  % premier pixel ``horizontal'' (0-based)
PARAM.window.s2 = xsize - 1;  % dernier pixel ``horizontal'' (0-based)
PARAM.window.sbin = 1;  % somme (bin) ``horizontal''
PARAM.window.p1 = 10;  % premier pixel ``vertical'' (0-based)
PARAM.window.p2 = ysize - 5;  % dernier pixel ``vertical'' (0-based)
% Le parametre PARAM.window.sbin est calcule automatiquement pour la fonction 'spectre'
PARAM.t_acc = 5; % 5 secondes d'acquisition
PARAM.n_acc = 2; % 2 acquisitions
data = camera_PrincetonInstruments('spectre', PARAM) % prend la mesure
plot(data)

% mesure une image simple (tout le detecteur, 1 seconde d'acquisition)
data = camera_PrincetonInstruments('image');

% mesure une image, somme ``verticalement'', acquisition de 2 secondes
PARAM.window  % conserve les parametre precedents
PARAM.window.pbin = 5  % somme ``verticalement'' 5 pixels
PARAM.t_acc=2  % acquisition de 2 secondes
data = camera_PrincetonInstruments('image',PARAM);

% Lit des parametres arbitraires (pas definis dans la fonction Camera_PrincetonInstruments.m)
% Pour la liste et la signification des parametres de PVCAM, se referer a
%  http://ftp.piacton.com/Public/Manuals/Princeton\%20Instruments/PVCAM\%202.7\%20Software\%20User\%20Manual.pdf
% distance 'horizontale' entre les pixels
Camera_PrincetonInstruments('GET_PARAMETER', 'PARAM_PIX_SER_DIST')
% nombre de bits valides dans les donnees retournees
Camera_PrincetonInstruments('GET_PARAMETER', 'PARAM_BIT_DEPTH')

% De maniere similaire que 'GET_PARAMETER', on peut ecrire un parametre avec 'SET_PARAMETER'.

% distance 'horizontale' et 'verticale' entre les pixels (utile pour la calibration pixel -> longueur d'onde) (centre a centre, nm)
[x,y] = Camera_PrincetonInstruments('PIXEL_DIMENSION')

% ferme la communication
Camera_PrincetonInstruments('fermer')

\end{lstlisting}

\subsection{PDA InGaAs}\index{PDA InGaAs}

Ce détecteur est une rangée de 1024 pixels sensibles jusqu'à 2.2 $\mu$m (à température pièce, la limite à basse température serait d'environ 2.1 $\mu$m).

Ce détecteur a besoin d'azote liquide pour fonctionner et on stabilise la température à -100 $^{\circ}$C.
Il {\bf doit} être connecté à son contrôleur (allumé) lorsqu'il y a de l'azote dans le réservoir.

Il est recommandé de pomper le vide d'isolation tous les 6 mois.

Étant donné qu'il est sensible à l'infrarouge, le bruit thermique est particulièrement important sur ce détecteur.
En général, on mesure 30 000 comptes {\it noirs} par seconde.
Étant donné que ce détecteur sature à ~64 000 comptes, on limite l'accumulation à une seconde.

On utilise la sortie $\overline{SCAN}$ du contrôleur pour l'obturateur mécanique.

On peut contrôler ce détecteur avec la fonction Matlab générique \verb!Camera_PrincetonInstruments.m!.

\begin{figure}[htbp]
  \centering\includegraphics[width=.5\linewidth,height=7cm,keepaspectratio]{pdaInGaAs}
  \caption{PDA InGaAs}
  \label{fig:pdaingaas}
\end{figure}

\subsection{Pixis}\index{Pixis}

La caméra Pixis (Pixis 256) est composé de 1024x256 pixels sensibles jusqu'à $\approx$ 1 $\mu$m.
Elle est refroidie par effet Pelletier à -70 $^{\circ}$C.

Cette caméra a un bruit de lecture d'environ 600 comptes et un bruit noir suffisamment bas pour être négligeable dans la plupart des cas.

On utilise la sortie LOGIC OUT du détecteur pour l'obturateur mécanique.

Tout comme la PDA InGaAS, on peut contrôler ce détecteur avec la fonction Matlab générique \verb!Camera_PrincetonInstruments.m!.

\begin{figure}[htbp]
  \centering\includegraphics[width=.5\linewidth]{pixis}
  \caption{Pixis}
  \label{fig:pixis}
\end{figure}


%----------------------------------------------------------------------------------------

\section{CCD Raman}\index{CCD Raman}
%\section{Winspec}\index{Winspec}

La caméra CCD fixée sur le U1000 est composé de 1340x400 pixels sensibles jusqu'à $\approx$ 1 $\mu$m.

Cette caméra est refroidie par effet Pelletier à -100 $^{\circ}$C.
Elle {\bf doit} être connectée à son contrôleur (allumé) lorsqu'il y a de l'azote dans le réservoir.

Il est recommandé de pomper le vide d'isolation tous les 6 mois.

Ce détecteur a besoin de Winspec32 pour pouvoir être contrôlée.
En plus de l'acquisition manuelle par Winspec, il est possible de le faire avec Python.
Cette dernière option permet d'automatiser l'acquisition.

\subsection{Python}

Le contrôle de la caméra par Python fonctionne selon le schéma suivant: 
\begin{center}
  \smartdiagramset{border color=none,
    uniform color list=gray!100!black for 10 items,
    back arrow disabled=true,}
  \smartdiagram[flow diagram:horizontal]{Python, Winspec, CCD Raman}
\end{center}

Il est donc nécessaire que Winspec soit en fonction lors de cette opération.
Un exemple minimal est donné dans Code~\ref{lst:exwinspec}.

\begin{lstlisting}[
    caption={Exemple d'utilisation de Winspec avec Python},
    label={lst:exwinspec},
    style=Python,
  ]  

import WinspecCOM
camera = WinspecCOM.winspec()

camera.initialConfiguration()  # set most common values in cosmic ray and temperature

camera.setTemperature(-100)  # set the target temperature to -100 C
camera.setTemperature()[0]  # read the target temperature
camera.actualTemperature()[0]  # read the actual temperature

# ROI (xmin, xmax, xgroup, ymin, ymax, ygroup)
camera.ROI(1, [1, 1340, 1, 1, 400, 400])  # set (for come reason, one have to manually confirm that in Winspec)
camera.ROI()  # read

# exposure unit 'ms', 's', 'min', 'h'
camera.exposureUnit('s')  # set
camera.exposureUnit()[0]  # read

# exposure time 
camera.exposure(1.5)  # set
camera.exposure()[0]  # read

# number of accumulations
camera.nAccumulations(2)  # set
camera.nAccumulations()[0]  # read

# ADC speed '100 kHz', '1 MHz'
camera.adcSpeed('100 kHz')
camera.adcSpeed()[0]

# background removal True, False
camera.removeBackground(True)  # set
camera.removeBackground()[0]  # read

# cosmic ray mode 'off', 'temporal', 'spatial'
camera.cosmicMode('spatial')  # set
camera.cosmicMode()[0]  # read

# cosmic ray sensitivity
camera.cosmicSensitivity(50)  # set
camera.cosmicSensitivity()[0]  # read

camera.acquireBackground()  # measure the background

# measurements
x, y, filename = camera.measureSimple()  # default values: accumulation for 1 second, one image and one accumulation
x, y, filename = camera.measureSimple(exposureTime=2)  # accumulation for 2 second2, default values: one image and one accumulation
# x and y contains position/intensity values
# filename is name of the saved file (.SPE format)

camera.getParamAll('test.txt')  # save current values in a file (nice for development)

camera.stop()  # stop current measurement

camera.isRunning()[0]  # check if camera is currently measuring
\end{lstlisting}

%----------------------------------------------------------------------------------------

\section{HydraHarp}\index{HydraHarp}

Le Hydra Harp (figure~\ref{fig:hydraharp}) est utilisé pour les mesures de comptage de photons corrélés.

Notre module comporte deux canaux d'entré en plus de la synchronisation.
Il est important de ne pas dépasser 1.5 Volt en entrée sur les canaux.

Les spécification et le logiciel de contrôle sont disponibles à l'adresse suivante: \url{http://www.picoquant.com/products/category/tcspc-and-time-tagging-modules/hydraharp-400-multichannel-picosecond-event-timer-tcspc-module}.

La boite de contrôle a une résolution temporelle de 1 ps.
Cependant, la réponse instrumentale des détecteurs (SPAD) limite la résolution effective à environ 200 ps.

\begin{figure}[htbp]
  \centering\includegraphics[width=.5\linewidth]{hydraharp}
  \centering\includegraphics[width=.5\linewidth]{spad}
  \caption{HydraHarp et détecteur SPAD}
  \label{fig:hydraharp}
\end{figure}

\begin{figure}[htbp]
  \centering\includegraphics[width=.5\linewidth]{sensibiliteSPAD}
  \caption{Sensibilité spectrale des détecteurs SPAD}
  \label{fig:spadSensibiliteSpectrale}
\end{figure}

\subsection{Détecteur} 

Les détecteurs\footnote{Fiche technique \url{https://www.picoquant.com/images/uploads/downloads/pdm_series.pdf}} (2) que nous possédons, sont des SPAD de marque MPD (micro photon devices) dans la série PDM.
Ils ont les caractéristiques suivantes: 50 $\mu$m, cooled, timing, Grade C. Ils doivent être alimentés pour fonctionner.

Il y a trois sorties sur les détecteurs: {\it TTL Out, Timing Out, Gate In}.
Pour les mesures en comptage de photon, nous utilisons la sortie {\it Timing Out}

Leur sensibilité en fonction de la longueur d'onde est illustrée à la figure~\ref{fig:spadSensibiliteSpectrale}.

\subsection{Logiciel du constructeur}

??? à compléter \\
FluoFit

\subsection{Matlab}

Le code Matlab présenté ici permet de mesurer en mode comptage de photon corrélé.
Dans l'état actuel, il ne permet pas d'accéder aux modes avancés (TTTR (enregistrement individuel temporel de tous les événements sur tous les canaux: T2 et T3).

\begin{lstlisting} [
    caption={Exemple d'utilisation de HydraHarp avec Matlab},
    label={lst:exhydraharp},
    style=Matlab-editor,
  ]
  
  % Initialise la communication et met le detecteur dans un mode predefini
  hydra('initialise')
  % Mesure avec les parametres suivants:
  %   Cree un fichier .dat (ascii) en plus du fichier .mat
  %   sync offset = 3 ps
  %   sync zero = 9 mV
  %   resolution = 8 ps
  %   input channel 1 trig level = 599 mV
  %   temps acquisition = 1 seconde (defaut)
  %   fichier de sortie = YYYYMMDDThhmmss.mat suivant la date et l'heure du debut de la mesure (defaut)
  %            par exemple 20160824T154223.mat pour une mesure faite le 24 aout 2016 a 15h42 et 23 secondes.
  [x,y] = hydra('measure', 'DAT', 'so', 3, 'sz',9, 'r',8 ,'il',1,599);
  % ferme la communication
  hydra('stop' )
  % taux de comptage des entrees
  [countRateSync, countRateInputs] = hydra('TAUX' )
  % place le detecteur dans un mode prefefini
  hydra('BASECONFIG')

\end{lstlisting}

%----------------------------------------------------------------------------------------

\section{Lockin Zurich Instruments}\index{Lockin Zurich Instruments}

\subsection{Matlab}

\begin{lstlisting}[frame=single,caption={Exemple d'utilisation du lockin Surich Instruments avec Matlab},label={lst:exlockinzi},breaklines=true,]  % Start your code-block
  
???
\end{lstlisting}

%----------------------------------------------------------------------------------------

\section{Matisse}\index{Matisse}

Le Matisse (figure~\ref{fig:matisse}) est un laser de longueur d'onde ajustable dans une plage d'environ 300 nm (Ti:Sa) et 100 nm (Colorant).
La puissance de sortie est de l'ordre de 2 watts.

\begin{table}[htbp]
  \centering
  \begin{tabular}{lcc}
                    & Ti:Sa       & Colorant \\
    \hline
    Spatial Mode    &	\multicolumn{2}{c}{TEM$_{00}$} \\
    Beam Radius     &  \multicolumn{2}{c}{0.7 mm (typical)}  \\
    Beam Divergence & 	\multicolumn{2}{c}{< 1 mrad (half angle)} \\
    Linewidth       & 	< 10 MHz rms (without stabilisation) & < 20 MHz rms (without stabilisation)\\
    & 	$\approx$ 30 kHz rms (with TS stabilisation) & 	< 50 kHz rms (with TS stabilisation) \\
    Amplitude Noise &  	\multicolumn{2}{c}{< 0.25\% rms (TS)}\\
    Beam Polarization & 	\multicolumn{2}{c}{horizontal} \\
  \end{tabular}
  \label{tab:matisseGeneralCharacteristics}
\end{table}


Chaque ensemble de mirroir permet de couvrir une plage d'environ 100 nm (voir tableau~\ref{tab:setMiroirsMatisse}).

\begin{table}[htbp]
  \centering
  \begin{tabular}{lll}
    Ensemble & Plage utile (nm) & Milieur de gain\\
    \hline
    MOS-1    & 700 - 780        & Ti:Sa\\
    MOS-2    & 750 - 870        & Ti:Sa\\
    MOS-3    & 860 - 1015       & Ti:Sa\\
    MOS-4    & 550 - 660        & Colorant\\
  \end{tabular}
  \label{tab:setMiroirsMatisse}
\end{table}

\includepdf[pages=-,]{Matisse_alignement_procedure_reverse.pdf}

Plusieurs documents d'entretien du Matisse non disponibles sur l'Internet sont regroupés dans le chapitre~\ref{chap:documents}.

On peut contrôler le Matisse avec le logiciel du constructeur où avec Python.
Les deux manières étant mutuellement exclusives\footnote{Les deux peuvent sembler fonctionner ensemble pendant un long moment, mais on aura d'éventuelles erreurs dans le code Python.}.

\begin{figure}[htbp]
  \centering\includegraphics[width=.5\linewidth]{matisse}
  \centering\includegraphics[width=.5\linewidth]{matisseOpticSets}
  \centering\includegraphics[width=.5\linewidth]{matisseSchemas}
  \caption{Matisse et sa cellule de référence, Plage d'utilisation des ensembles de mirroirs (Ti:Sa), Schémas optique de la cavité}
  \label{fig:matisse}
\end{figure}


\subsection{Logiciel du contructeur}

Étant donné des choix de conception de Sirah, chaque Matisse doit être contrôlé avec son propre logiciel\footnote{\url{Téléchargement: http://www.sirah.com/laser/cw-ring-lasers/matisse-commander-software}}.
On ne peut pas interchanger les deux lasers parce que le logiciel stoque la configuration de son laser attitré.
Pour une raison apparentée, on ne peut pas contrôler les deux lasers avec le même ordinateur\footnote{Le code Python permet de contrôler les deux lasers en même temps.}.

La version du logiciel utilisé doit correspondre à celle du microgiciel dans le contrôleur du laser.

\subsection{Python}

La classe Matisse sert à interagir avec le laser Matisse.
On peut contrôler les deux Matisses (éventuellement en même temps) avec Python.
%Il s'agit d'une classe très ciblée puisqu'en dehors de l'initialisation on ne peut faire qu'une chose: mesurer.
Voir Code~\ref{lst:exmatisse} pour un exemple d'utilisation.

\begin{lstlisting}[
    caption={Exemple d'utilisation du Matisse avec Python},
    label={lst:exmatisse},
    style=Python,
  ]

# importe le module
  import Matisse

  ??? tests a ajuster!!! ???
  class
  xrange
  for a = 't':

  if

  % toto
\end{lstlisting}

\subsection{Wavemeter}

Les Matisse sont équipés de {\it wavemeter} permettant de lire la longueur d'onde de sortie.
La section~\ref{wavemeter} explique comment lire la longueur d'onde à partir de Python.

%----------------------------------------------------------------------------------------

\section{Millenia}\index{Millenia}

Le Millenia (figure~\ref{fig:millenia}) sert à pomper le Matisse.

La fa\c{c}on la plus simple d'utiliser ce laser est en mode manuel où les parametres sont ajustés au moyen de la boite de contrôle.
On peut également contrôler 

\begin{figure}[htbp]
\centering\includegraphics[width=.5\linewidth]{milleniaPro}
\caption{Millenia}
\label{fig:millenia}
\end{figure}

%----------------------------------------------------------------------------------------

\section{Racal Dana}\index{Racal Dana}

L'appareil Racal Dana 1991 (figure \ref{fig:racaldana}) est utilisé comme compteur de photon.
Sa configuration manuelle est difficile; c'est pourquoi on préfère le configurer de fa\c{c}on logicielle.
On établi donc la communication avec l'appareil à partir d'un ordinateur et on lui envoie les commandes appropriées.

Pour pouvoir bien fonctionner, le compteur de photon a besoin d'une référence temporelle.
Pour ce faire, nous utilisons la sortie {\it 10 MHz Output} comme entrée de {\it Input B}.
Le comptage se fait proprement dit sur l'entrée {\it Input A}.

Cet appareil possède deux interfaces logicielles soient Matlab et Python.

\begin{figure}[htbp]
\centering\includegraphics[width=.5\linewidth]{RacalDana1991}
\caption{Racal Dana 1991}
\label{fig:racaldana}
\end{figure}

\subsection{Matlab}

\subsection{Python}

La classe RacalDana sert à interagir avec le compteur de photon Racal Dana 1991.
Il s'agit d'une classe très ciblée puisqu'en dehors de l'initialisation on ne peut faire qu'une chose: mesurer.
Voir Code~\ref{lst:exracaldana} pour un exemple d'utilisation.

\begin{lstlisting}[
    caption={Exemple d'utilisation de {\it RacalDana avec Python}},
    label={lst:exracaldana},
    style=Python,
    ]  
 
import racalDana  # importe le module

# initialise la communication (on suppose l'adresse GPIB 3)
compteur = racalDana.RacalDana('GPIB0::3::INSTR') 

# mesure pendant 5 secondes
comptes = compteur.measure(exposureTime=5)
\end{lstlisting}

%----------------------------------------------------------------------------------------

\section{SP275}\index{SP275}

Le spectromètre Acton Research SP275\footnote{Manuel: \url{http://ftp.piacton.com/Public/Manuals/Acton/SP-275_Obsolete.pdf}} (Figure \ref{fig:sp275}) est un spectromètre simple doté d'une tourelle de 3 réseaux (Table~\ref{table:reseauxSP275}).
Ce spectromètre fonctionne bien dans l'UV.

\begin{table}[htbp]
  \caption{Réseaux du spectromètre Acton Research SP275}
  \label{table:reseauxSP275}
  \centering
%  \resizebox{\textwidth}{!}{%  
    \begin{tabular}{ccc}
    Réseau & Densité    & Blaze \\ \hline
    ~      & (l/mm)     & (nm)  \\
    1      & 2400       & Hol     \\
    2      & 1200       & 300     \\
    3      & 1200       & Hol     \\
    \end{tabular}
%  }
\end{table}

Pour contrôler ce spectromètre avec un ordinateur, on connecte celui-ci avec le contrôleur du spectromètre (SpectraDrive) par GPIB.

\begin{figure}[htbp]
\centering\includegraphics[width=.5\linewidth]{sp275}
\caption{Acton Research SP275}
\label{fig:sp275}
\end{figure}

\subsection{Matlab}

La fonction SP275.m permet de contrôler le spectromètre avec Matlab.
Code~\ref{lst:exsp275} donne un exemple d'utilisation simple.

\begin{lstlisting} [
    caption={Exemple d'utilisation du SP275 avec Matlab},
    label={lst:exsp275},
    style=Matlab-editor,
]

??? Code entre sans test. Verifier que c'est valide ???
  
SP275('initialise')  % initialise la communication

% Reseaux
SP275('?GRATINGS')  % liste des reseaux disponibles
SP275('?GRATING')  % lit le reseau actuel
SP275('GRATING', 3)  % selectionne un reseau en particulier

% decalage
SP275('OFFSET', 1)  %  defini le offset a 1 nm

% position
SP275('?NM')  % lit la longueur d'onde actuelle
SP275('GOTO', 532.1)  % deplace vers 532.1 nm
  
\end{lstlisting}

%\subsubsection{Détecteurs}

%----------------------------------------------------------------------------------------

\section{SR400}\index{SR400}

\begin{figure}[htbp]
\centering\includegraphics[width=.5\linewidth]{sr400}
\caption{Standford Research Systems SR400}
\label{fig:sr400}
\end{figure}

\subsection{Matlab}

%La fonction ???.m permet de contrôler le compteur de photons avec Matlab.
Code~\ref{lst:exsr400} donne un exemple d'utilisation simple.

\begin{lstlisting} [
    caption={Exemple d'utilisation du SR400 avec Matlab},
    label={lst:exsr400},
    style=Matlab-editor,
]

??? Code entre sans test. Verifier que c'est valide ???
  
\end{lstlisting}

%----------------------------------------------------------------------------------------

\section{SR830}\index{SR830}

\begin{figure}[htbp]
\centering\includegraphics[width=.5\linewidth]{sr830}
\caption{Standford Research Systems SR830}
\label{fig:sr830}
\end{figure}

\subsection{Matlab}

%La fonction ???.m permet de contrôler l'amplificateur synchrone avec Matlab.
Code~\ref{lst:exsr830} donne un exemple d'utilisation simple.

\begin{lstlisting} [
    caption={Exemple d'utilisation du SR830 avec Matlab},
    label={lst:exsr830},
    style=Matlab-editor,
]

??? Code entre sans test. Verifier que c'est valide ???
  
\end{lstlisting}

\subsection{Python}

%La fonction ???.py permet de contrôler l'amplificateur synchrone avec Python.
Code~\ref{lst:exsr830python} donne un exemple d'utilisation simple.

\begin{lstlisting} [
    caption={Exemple d'utilisation du SR830 avec Python},
    label={lst:exsr830python},
    style=Python,
]

??? Code entre sans test. Verifier que c'est valide ???
  
\end{lstlisting}

%----------------------------------------------------------------------------------------

\section{Trivista}\index{Trivista}

\begin{figure}[htbp]
\centering\includegraphics[width=.5\linewidth]{trivista}
\caption{Princeton Instruments Trivista}
\label{fig:trivista}
\end{figure}

\subsection{Matlab}

%La fonction ???.m permet de contrôler le spectromètre avec Matlab.
Code~\ref{lst:extrivista} donne un exemple d'utilisation simple.

\begin{lstlisting} [
    caption={Exemple d'utilisation du Trivista avec Matlab},
    label={lst:extrivista},
    style=Matlab-editor,
]

??? Code entre sans test. Verifier que c'est valide ???
  
\end{lstlisting}

%----------------------------------------------------------------------------------------

\section{Verdi}\index{Verdi}

%----------------------------------------------------------------------------------------

\section{Wavemeter}\index{Wavemeter}\label{wavemeter}

Le Wavemeter sert à donner une mesure précise de la longueur d'onde du laser sortant du Matisse.

\subsection{Lecture}
Il est possible de lire la longueur d'onde mesurée par l'instrument en utilisant deux faux ports série.
Sur windows, il faut installer le logiciel {\it com0com}\footnote{\url{http://com0com.sourceforge.net}}.
On crée ensuite deux ports séries (com 90 et com 91) reliés ensemble.
Le logiciel du Wavemeter (qui doit être démarré et en mode acquisition) écrit ses résultats sur com 90 (???).
Ce dernier recopie tout sur com 91.
Il suffit de lire les résultats sur com 91.
Un exemple de code est donné dans Code~\ref{lst:exwavemeter}.

Cette fonction est implémentée dans la classe Matisse, dans la fonction (en fait une propriété) realWavelength.

\subsection{Python}

\begin{lstlisting}[
    caption={Exemple d'utilisation du Wavemeter avec Python},
    label={lst:exwavemeter},
    style=Python,
    ]  

import Matisse
laser = Matisse.Matisse()

print(laser.realWavelength)
\end{lstlisting}


%----------------------------------------------------------------------------------------
%	CHAPTER 3
%----------------------------------------------------------------------------------------

\chapterimage{laser} % Chapter heading image

\chapter{Expériences}

\section{Absorption (UV)}\index{Absorption (UV)}

%----------------------------------------------------------------------------------------
\section{micro-Photoréflectance}\index{micro-Photoréflectance}

%----------------------------------------------------------------------------------------
\section{micro-Raman}\index{micro-Raman}

%----------------------------------------------------------------------------------------
\section{Photoluminescence}

%----------------------------------------------------------------------------------------
\subsection{Trivista}\index{Photoluminescence (Trivista)}

%----------------------------------------------------------------------------------------
\subsection{U1000}\index{Photoluminescence (U1000)}

%----------------------------------------------------------------------------------------
\section{Photoluminescence résolue temporellement}\index{Photoluminescence résolue temporellement}

%----------------------------------------------------------------------------------------
\section{Raman}\index{Raman}

\subsection{U1000}

\begin{lstlisting}[
    caption={Mesure Raman avec le U1000 et sa CCD},
    label={lst:ramanU1000},
    style=Python,
  ]  
import test_mesure as mesure

# lire visuellement la longueur d'onde sur le compteur du spectrometre
# ex.: 5399
m = mesure.Mesure(5399)
# m represente l;instrument de mesure

#entrer la longueur d'onde du laser
m.setLaser(5321)

#entrer le decalage du spectrometre entre affichage et realite
m.spectrometer.positionOffset = 0
# faire une mesure sur un pic de longueur d'onde connue (voir par exemple plus bas pour la raie du Hg
positionVraie = 5460.735
positionMesure = 5458.97
m.spectrometer.positionOffset = positionVraie - positionMesure

#pour faire une mesure entre 150 et 550 cm-1
#acquisition de 10 secondes par position
#5 repetitions par position (a partir de 5, un algorithme enleve efficacement les pics du aux "rayons cosmiques"
#chaque position est mesuree a 4 endroits differents sur la CCD (pour enlever le flatfield)
#mesure en cm-1 relatif

x,y = m.measureRange([150, 550], accTime=10, images=5, nOverlap=4, unit='cm-1')

# pour mesurer la raie du Hg
# mesure en Angstroem
x,y = m.measureRange(5461, accTime=1, images=10, nOverlap=5, unit='A')
\end{lstlisting}


%----------------------------------------------------------------------------------------
%	PART
%----------------------------------------------------------------------------------------

%\part{Deuxième partie}
 
\chapter{Documents}
\label{chap:documents}

\include{feuilleUtilisateurs}

%\section{Matisse}
\includepdf[pages=-]{Documents/MSN_1-PiezoEtalonModulationCheck.pdf}
\includepdf[pages=-]{Documents/MSN-3-Opening-S-Refcell.pdf}
\includepdf[pages=-]{Documents/MSN-4_CheckingRefCellDither.pdf}
\includepdf[pages=-]{Documents/MSN-6_CheckingSlowPiezo.pdf}
\includepdf[pages=-]{Documents/MSN-7_CheckingSlowPiezoAmpCard.pdf}
\includepdf[pages=-]{Documents/piezo_etalon_driver_card_check.pdf}
%----------------------------------------------------------------------------------------
%	INDEX
%----------------------------------------------------------------------------------------

\cleardoublepage
\phantomsection
\setlength{\columnsep}{0.75cm}
\addcontentsline{toc}{chapter}{\textcolor{ocre}{Index}}
\printindex

%----------------------------------------------------------------------------------------

\end{document}
